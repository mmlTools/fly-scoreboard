<h1>Templating System</h1>
<p class="lead">
The overlay runtime (<code>script.js</code>) scans your HTML for template placeholders <code>{{…}}</code> and replaces them from <code>plugin.json</code>. It also supports conditional rendering with <code>fs-if</code>.
</p>

<h2>Data source: plugin.json</h2>
<p>
The plugin writes state to <code>plugin.json</code>. The default schema includes:
</p>
<ul>
  <li><code>home</code> and <code>away</code> objects (title, subtitle, logo, color)</li>
  <li><code>custom_fields[]</code> (label, home, away, visible)</li>
  <li><code>timers[]</code> (label, mode, remaining_ms, last_tick_ms, running, visible)</li>
  <li><code>single_stats[]</code> (label, value, visible)</li>
  <li><code>swap_sides</code>, <code>show_scoreboard</code></li>
</ul>

<h2>Derived view model (team_x / team_y / fields_xy)</h2>
<p>
Before applying templates, the runtime builds a “view model” so you can design for left/right without duplicating swap logic:
</p>
<ul>
  <li><code>team_x</code> - left team (home or away depending on <code>swap_sides</code>)</li>
  <li><code>team_y</code> - right team</li>
  <li><code>fields_xy[]</code> - each custom field mapped to left/right as <code>x</code>/<code>y</code></li>
</ul>

<div class="note">
  If you use <code>custom_fields[0].home</code> directly, you must handle swap logic yourself. Prefer <code>fields_xy[0].x</code> and <code>fields_xy[0].y</code>.
</div>

<h2>{{ … }} placeholders</h2>
<p>
Placeholders can appear in text nodes or any attribute value. The expression is a <strong>path</strong> into the JSON/view model, with optional array indexing.
</p>

<pre><code>&lt;div class="team-name"&gt;{{team_x.title}}&lt;/div&gt;
&lt;img src="{{team_x.logo}}" alt="" /&gt;
&lt;div class="score"&gt;{{fields_xy[0].x}}&lt;/div&gt;
&lt;div class="clock"&gt;{{timers[0].mmss}}&lt;/div&gt;</code></pre>

<h3>Ternary in attributes</h3>
<p>
For simple attribute switching, the runtime supports a ternary with quoted literals:
</p>
<pre><code>&lt;div class="{{show_scoreboard ? 'board' : 'board is-hidden'}}"&gt;...&lt;/div&gt;</code></pre>

<h2>fs-if (conditional visibility)</h2>
<p>
Use <code>fs-if</code> to show/hide an element based on a boolean expression:
</p>
<pre><code>&lt;div fs-if="timers[0] &amp;&amp; timers[0].visible"&gt;
  {{timers[0].mmss}}
&lt;/div&gt;</code></pre>

<p>
Supported operators:
</p>
<ul>
  <li><code>!</code> (NOT), <code>&amp;&amp;</code> (AND), <code>||</code> (OR)</li>
  <li>parentheses <code>( ... )</code> for grouping</li>
</ul>

<h2>Timer rendering details</h2>
<p>
To keep timers smooth, the runtime computes <code>timers[i].live_ms</code> every frame based on:
</p>
<ul>
  <li><code>remaining_ms</code> - the last value written by the plugin</li>
  <li><code>last_tick_ms</code> - the last update timestamp (milliseconds)</li>
  <li><code>running</code> and <code>mode</code> (<code>countup</code> / <code>countdown</code>)</li>
</ul>

<pre><code>// Simplified:
if (!running || !last_tick_ms) return remaining_ms;
delta = now - last_tick_ms;
return mode === "countup" ? remaining_ms + delta : max(0, remaining_ms - delta);</code></pre>

<h2>Overlay authoring checklist</h2>
<ul>
  <li>Keep <code>index.html</code>, <code>script.js</code>, and <code>plugin.json</code> aligned (paths matter).</li>
  <li>Prefer <code>team_x</code>/<code>team_y</code> and <code>fields_xy</code> for swap-safe designs.</li>
  <li>Guard optional items with <code>fs-if</code> to avoid “undefined” placeholders.</li>
</ul>